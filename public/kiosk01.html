<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Kiosk - FlowMatic-SOLO R2</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4a5568;
        }

        .header-center {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .current-time {
            font-size: 1.2rem;
            color: #666;
            font-weight: 500;
        }

        .language-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .lang-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .lang-btn.active,
        .lang-btn:hover {
            background: #667eea;
            color: white;
        }

        .home-button {
            background: #48bb78;
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .home-button:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .welcome-section {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
        }

        .welcome-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .service-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .service-card.selected {
            border: 3px solid #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .service-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .service-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }

        .service-description {
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .queue-info {
            background: #f7fafc;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .queue-count {
            font-size: 1.1rem;
            font-weight: bold;
            color: #667eea;
        }

        .wait-time {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }

        .customer-form {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            display: none;
        }

        .customer-form.active {
            display: block;
        }

        .form-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: #2d3748;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #4a5568;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .ticket-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .ticket-modal.active {
            display: flex;
        }

        .ticket-content {
            background: white;
            border-radius: 15px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
        }

        .ticket-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: #48bb78;
        }

        .ticket-number {
            font-size: 3rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .ticket-details {
            background: #f7fafc;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            text-align: left;
        }

        .ticket-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            background: #48bb78;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .services-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .form-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">FlowMatic-SOLO R2</div>
        <div class="header-center">
            <div class="current-time" id="currentTime"></div>
            <div class="language-toggle">
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="th">TH</button>
                <button class="lang-btn" data-lang="hi">HI</button>
            </div>
        </div>
        <a href="/" class="home-button">
            üè† Home
        </a>
    </div>

    <div class="container">
        <div class="welcome-section">
            <h1 class="welcome-title" data-text="welcome-title">Welcome to FlowMatic-SOLO</h1>
            <p class="welcome-subtitle" data-text="welcome-subtitle">Please select a service to get your queue ticket</p>
        </div>

        <div class="services-grid" id="servicesGrid">
            <!-- Services will be loaded here -->
        </div>

        <div class="customer-form" id="customerForm">
            <h2 class="form-title" data-text="form-title">Customer Information</h2>
            <form id="ticketForm">
                <div class="form-group">
                    <label class="form-label" data-text="name-label">Customer Name (Optional)</label>
                    <input type="text" class="form-input" id="customerName" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label class="form-label" data-text="phone-label">Phone Number (Optional)</label>
                    <input type="tel" class="form-input" id="customerPhone" placeholder="Enter your phone number">
                </div>
                <div class="form-group">
                    <label class="form-label" data-text="email-label">Email Address (Optional)</label>
                    <input type="email" class="form-input" id="customerEmail" placeholder="Enter your email address">
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" id="backBtn" data-text="back-btn">Back to Services</button>
                    <button type="submit" class="btn btn-primary" id="generateBtn" data-text="generate-btn">Generate Ticket</button>
                </div>
            </form>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p data-text="generating">Generating your ticket...</p>
        </div>
    </div>

    <div class="ticket-modal" id="ticketModal">
        <div class="ticket-content">
            <h2 class="ticket-title" data-text="ticket-success">Ticket Generated Successfully!</h2>
            <div class="ticket-number" id="ticketNumber">A001</div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span data-text="status-waiting">Your ticket is in the queue</span>
            </div>
            <div class="ticket-details" id="ticketDetails">
                <!-- Ticket details will be populated here -->
            </div>
            <div class="form-buttons">
                <button class="btn btn-secondary" id="printBtn" data-text="print-btn">üñ®Ô∏è Print Ticket</button>
                <button class="btn btn-primary" id="closeBtn" data-text="close-btn">Done</button>
            </div>
        </div>
    </div>

    <script>
        // Multi-language support
        const translations = {
            en: {
                'welcome-title': 'Welcome to FlowMatic-SOLO',
                'welcome-subtitle': 'Please select a service to get your queue ticket',
                'form-title': 'Customer Information',
                'name-label': 'Customer Name (Optional)',
                'phone-label': 'Phone Number (Optional)',
                'email-label': 'Email Address (Optional)',
                'back-btn': 'Back to Services',
                'generate-btn': 'Generate Ticket',
                'generating': 'Generating your ticket...',
                'ticket-success': 'Ticket Generated Successfully!',
                'status-waiting': 'Your ticket is in the queue',
                'print-btn': 'üñ®Ô∏è Print Ticket',
                'close-btn': 'Done',
                'waiting': 'waiting',
                'estimated-wait': 'Estimated wait'
            },
            th: {
                'welcome-title': '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà FlowMatic-SOLO',
                'welcome-subtitle': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏¥‡∏ß',
                'form-title': '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',
                'name-label': '‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)',
                'phone-label': '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)',
                'email-label': '‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)',
                'back-btn': '‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£',
                'generate-btn': '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏¥‡∏ß',
                'generating': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...',
                'ticket-success': '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!',
                'status-waiting': '‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß',
                'print-btn': 'üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏¥‡∏ß',
                'close-btn': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
                'waiting': '‡∏£‡∏≠',
                'estimated-wait': '‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì'
            },
            hi: {
                'welcome-title': 'FlowMatic-SOLO ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à',
                'welcome-subtitle': '‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§ï‡•ç‡§Ø‡•Ç ‡§ü‡§ø‡§ï‡§ü ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§∏‡•á‡§µ‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç',
                'form-title': '‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä',
                'name-label': '‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)',
                'phone-label': '‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)',
                'email-label': '‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)',
                'back-btn': '‡§∏‡•á‡§µ‡§æ‡§ì‡§Ç ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç',
                'generate-btn': '‡§ü‡§ø‡§ï‡§ü ‡§ú‡•á‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç',
                'generating': '‡§Ü‡§™‡§ï‡§æ ‡§ü‡§ø‡§ï‡§ü ‡§ú‡•á‡§®‡§∞‡•á‡§ü ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...',
                'ticket-success': '‡§ü‡§ø‡§ï‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•á‡§®‡§∞‡•á‡§ü ‡§π‡•Å‡§Ü!',
                'status-waiting': '‡§Ü‡§™‡§ï‡§æ ‡§ü‡§ø‡§ï‡§ü ‡§ï‡•ç‡§Ø‡•Ç ‡§Æ‡•á‡§Ç ‡§π‡•à',
                'print-btn': 'üñ®Ô∏è ‡§ü‡§ø‡§ï‡§ü ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç',
                'close-btn': '‡§∏‡§Æ‡§æ‡§™‡•ç‡§§',
                'waiting': '‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ',
                'estimated-wait': '‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ'
            }
        };

        // Services configuration (matching database)
        const services = [
            { id: 1, name: 'General Service', prefix: 'A', description: 'General inquiries and services', icon: 'üè¢' },
            { id: 2, name: 'Account Services', prefix: 'B', description: 'Account opening, modifications', icon: 'üí≥' },
            { id: 3, name: 'VIP Services', prefix: 'V', description: 'Premium customer services', icon: '‚≠ê' },
            { id: 4, name: 'Technical Support', prefix: 'T', description: 'Technical assistance and support', icon: 'üîß' }
        ];

        // Global variables
        let socket;
        let selectedService = null;
        let currentLanguage = localStorage.getItem('language') || 'en';
        let queueCounts = {};

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTime();
            initializeLanguage();
            initializeSocket();
            renderServices();
            bindEvents();
        });

        function initializeTime() {
            function updateTime() {
                const now = new Date();
                document.getElementById('currentTime').textContent = now.toLocaleTimeString();
            }
            updateTime();
            setInterval(updateTime, 1000);
        }

        function initializeLanguage() {
            // Set active language button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === currentLanguage);
            });
            updateLanguage();
        }

        function updateLanguage() {
            const texts = translations[currentLanguage];
            document.querySelectorAll('[data-text]').forEach(element => {
                const key = element.dataset.text;
                if (texts[key]) {
                    element.textContent = texts[key];
                }
            });
        }

        function initializeSocket() {
            socket = io('/kiosk');
            
            socket.on('connect', () => {
                console.log('Connected to kiosk namespace');
                socket.emit('join-all', {});
            });

            socket.on('queue-updated', (data) => {
                console.log('Queue updated:', data);
                if (data.serviceId) {
                    queueCounts[data.serviceId] = data.queue;
                    updateServiceCard(data.serviceId, data.queue);
                }
            });

            socket.on('ticket-created', (data) => {
                console.log('Ticket created:', data);
                // Real-time confirmation of ticket creation
            });

            socket.on('disconnect', () => {
                console.log('Disconnected from kiosk namespace');
            });
        }

        function renderServices() {
            const grid = document.getElementById('servicesGrid');
            grid.innerHTML = '';

            services.forEach(service => {
                const card = document.createElement('div');
                card.className = 'service-card';
                card.dataset.serviceId = service.id;
                
                card.innerHTML = `
                    <div class="service-icon">${service.icon}</div>
                    <div class="service-name">${service.name}</div>
                    <div class="service-description">${service.description}</div>
                    <div class="queue-info">
                        <div class="queue-count" id="queue-${service.id}">0 ${translations[currentLanguage]['waiting']}</div>
                        <div class="wait-time" id="wait-${service.id}">${translations[currentLanguage]['estimated-wait']}: 0 min</div>
                    </div>
                `;

                card.addEventListener('click', () => selectService(service));
                grid.appendChild(card);
            });
        }

        function updateServiceCard(serviceId, queueData) {
            const queueElement = document.getElementById(`queue-${serviceId}`);
            const waitElement = document.getElementById(`wait-${serviceId}`);
            
            if (queueElement && queueData) {
                const waitingCount = queueData.waiting || 0;
                const estimatedWait = Math.ceil(waitingCount * 5); // 5 minutes per ticket estimate
                
                queueElement.textContent = `${waitingCount} ${translations[currentLanguage]['waiting']}`;
                waitElement.textContent = `${translations[currentLanguage]['estimated-wait']}: ${estimatedWait} min`;
            }
        }

        function selectService(service) {
            selectedService = service;
            
            // Update UI
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.toggle('selected', card.dataset.serviceId == service.id);
            });

            // Show customer form
            document.getElementById('servicesGrid').style.display = 'none';
            document.getElementById('customerForm').classList.add('active');
            
            // Update form title with service name
            document.querySelector('.form-title').textContent = `${service.name} - ${translations[currentLanguage]['form-title']}`;
        }

        function bindEvents() {
            // Language toggle
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentLanguage = btn.dataset.lang;
                    localStorage.setItem('language', currentLanguage);
                    
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    updateLanguage();
                    renderServices(); // Re-render to apply language
                });
            });

            // Back button
            document.getElementById('backBtn').addEventListener('click', () => {
                document.getElementById('customerForm').classList.remove('active');
                document.getElementById('servicesGrid').style.display = 'grid';
                selectedService = null;
                
                // Clear selection
                document.querySelectorAll('.service-card').forEach(card => {
                    card.classList.remove('selected');
                });
            });

            // Form submission
            document.getElementById('ticketForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await generateTicket();
            });

            // Modal buttons
            document.getElementById('printBtn').addEventListener('click', () => {
                window.print();
            });

            document.getElementById('closeBtn').addEventListener('click', () => {
                closeTicketModal();
            });
        }

        async function generateTicket() {
            if (!selectedService) return;

            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const customerEmail = document.getElementById('customerEmail').value.trim();

            // Show loading
            document.getElementById('customerForm').style.display = 'none';
            document.getElementById('loading').classList.add('active');

            try {
                const response = await fetch('/api/kiosk/tickets', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        serviceId: selectedService.id,
                        customerName: customerName || null,
                        customerPhone: customerPhone || null,
                        customerEmail: customerEmail || null
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showTicketModal(data);
                } else {
                    throw new Error(data.error || 'Failed to generate ticket');
                }
            } catch (error) {
                console.error('Error generating ticket:', error);
                alert('Failed to generate ticket. Please try again.');
                
                // Return to form
                document.getElementById('loading').classList.remove('active');
                document.getElementById('customerForm').style.display = 'block';
            }
        }

        function showTicketModal(ticketData) {
            document.getElementById('loading').classList.remove('active');
            
            // Update ticket display
            document.getElementById('ticketNumber').textContent = ticketData.ticketNumber;
            
            const details = document.getElementById('ticketDetails');
            details.innerHTML = `
                <div class="ticket-detail">
                    <span><strong>Service:</strong></span>
                    <span>${ticketData.serviceName}</span>
                </div>
                <div class="ticket-detail">
                    <span><strong>Queue Position:</strong></span>
                    <span>${queueCounts[ticketData.serviceId]?.waiting || 'N/A'}</span>
                </div>
                <div class="ticket-detail">
                    <span><strong>Estimated Wait:</strong></span>
                    <span>${ticketData.estimatedWaitMinutes} minutes</span>
                </div>
                <div class="ticket-detail">
                    <span><strong>Created:</strong></span>
                    <span>${new Date(ticketData.createdAt).toLocaleString()}</span>
                </div>
            `;
            
            document.getElementById('ticketModal').classList.add('active');
        }

        function closeTicketModal() {
            document.getElementById('ticketModal').classList.remove('active');
            
            // Reset form and return to services
            document.getElementById('ticketForm').reset();
            document.getElementById('customerForm').classList.remove('active');
            document.getElementById('servicesGrid').style.display = 'grid';
            selectedService = null;
            
            // Clear selection
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('selected');
            });
        }
    </script>
</body>
</html>